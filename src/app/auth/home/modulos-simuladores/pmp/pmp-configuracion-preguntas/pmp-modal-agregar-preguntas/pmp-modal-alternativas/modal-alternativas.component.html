<div class="tituloModal">
  <div style="font-weight: bold;">
    Configuracion alternativa
  </div>
  <div>
    <div class="botonCerrarModalAlternativa" (click)="this.dialogRef.close();">
      X
    </div>
  </div>
</div>
<form [formGroup]="formAlternativa">
  <div class="agregarCategoria" style="padding: 25px;">
    <div class="row" style="display:flex">
      <div class="col-12 col-md-6"style="display:flex">
        <div class="col-12 col-md-4 textoInputModalAlternativa">
          Alternativa*:
        </div>
        <div class="col-12 col-md-8">
          <mat-form-field class="example-full-width" appearance="outline" >
            <mat-label>Ingrese a la alternativa</mat-label>
            <input type="text"  formControlName="Respuesta" matInput />
            <!-- <mat-error *ngIf="formAlternativa.invalid">{{obtenerErrorCampoNombre('respuesta')}}</mat-error> -->
          </mat-form-field>
        </div>
      </div>
      <div class="col-12 col-md-2"style="display:flex">
        <div class="col-12 col-md-7 textoInputModalAlternativa">
          Correcto*:
        </div>
        <div class="col-12 col-md-5" style="align-items: center;display: flex;margin-top: -10px;">
          <mat-checkbox style="margin-top: -13px;" color="primary"  formControlName="Correcto"
             class="example-full-width" appearance="outline"></mat-checkbox>
        </div>
      </div>
      <div class="col-12 col-md-4"style="display:flex">
        <div class="col-12 col-md-3 textoInputModalAlternativa">
          Puntaje*:
        </div>
        <div class="col-12 col-md-9">
          <mat-form-field class="example-full-width" appearance="outline" >
            <mat-label>Ingrese el puntaje</mat-label>
            <input type="number"  formControlName="Puntaje" min="0" max="1" matInput />
            <!-- <mat-error *ngIf="formAlternativa.invalid">{{obtenerErrorCampoNombre('Puntaje')}}</mat-error> -->
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-12"style="display:flex">
        <div class="col-12 col-md-2 textoInputModalAlternativa">
          Video:
        </div>
        <div class="col-12 col-md-10">
         <mat-form-field class="example-full-width" appearance="outline" >
            <mat-label>Url del video</mat-label>
            <input type="text"  formControlName="UrlRetroalimentacionVideo" matInput />
            <!-- <mat-error *ngIf="formAlternativa.invalid">{{obtenerErrorCampoNombre('urlRetroalimentacionVideo')}}</mat-error> -->
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-12"style="display:flex">
        <div class="col-12 col-md-2 textoInputModalAlternativa">
          Texto:
        </div>
        <div class="col-12 col-md-10">
          <textarea style="width: 100%; border-radius: 5px;"
          name="textarea"
          rows="4"
          placeholder="[Ingrese el texto]"
          formControlName="Retroalimentacion"
          ></textarea>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-12" style="display:flex; margin-bottom: 10px;margin-top:10px">
        <div class="col-12 col-md-2" style="font-size: 15px;font-weight: bold;">
          Imagen:
        </div>
        <div class="col-12 col-md-10">
          <input type="file" id="UrlImagenArchivo" (change)="getFileDetailsRespuesta($event)"/>
        </div>
      </div>
    </div>
    <div class="row" style="margin-top:15px">
      <div class="col-12 col-md-6" style="text-align: right;">
        <button mat-flat-button style="background: #FF850C; color: white;width: 9rem;border-radius: 15px;" (click)="Enviar()">Guardar Cambios</button>
      </div>
      <div  class="col-12 col-md-6">
        <button mat-flat-button style="background: #FC5757;color:white;width: 9rem;border-radius: 15px;" (click)="Cancelar()">Cancelar</button>
      </div>
    </div>
  </div>
</form>



CREATE VIEW pw.V_PW_ObtenerReporteGeneralSimuladorPbi
AS

SELECT
		MC.Id AS IdMatriculaCabecera,
		MC.CodigoMatricula AS CodigoMatricula,
		AL.Id AS IdAlumno,
		CONCAT(AL.Nombre1,' ',AL.Nombre2,' ',AL.ApellidoPaterno,' ',AL.ApellidoMaterno) AS Alumno,
		CC.Nombre AS CentroCostos,
		(CASE
		WHEN MC.IdPaquete=1 THEN 
			'Versión Básica'
		WHEN MC.IdPaquete=2 THEN 
			'Versión Profesional'
		WHEN MC.IdPaquete=3 THEN 
			'Versión Gerencial'
		ELSE 
			'Sin Versión'
	END) AS TipoMatricula,
	ASWM2.FechaCreacion AS FechaMatriculaSimulador,
	(SELECT MAX(Desempenio) FROM [40.76.216.5].[integraDB_Simulador].Pbi.t_Pbi_examen AS PbiE WHERE IdAspNetUsers=ASP.Id AND PbiE.EstadoExamen=3 and IdSimuladorPbiModo=3) AS PuntajeMaximo,
	(SELECT ROUND(CAST (AVG(Desempenio) AS DECIMAL (6,2)),2) FROM [40.76.216.5].[integraDB_Simulador].Pbi.t_Pbi_examen AS PbiE WHERE IdAspNetUsers=ASP.Id AND PbiE.EstadoExamen=3 and IdSimuladorPbiModo=3) AS PuntajePromedio,
	(SELECT COUNT(*)
 FROM [40.76.216.5].[integraDB_Simulador].Pbi.t_Pbi_examen AS PbiE WHERE IdAspNetUsers=ASP.Id AND PbiE.EstadoExamen=3 and IdSimuladorPbiModo=3) AS SimulacionesFinalizadas,
	(SELECT TOP 1 FechaCreacion FROM [40.76.216.5].[integraDB_Simulador].Pbi.t_Pbi_examen AS PbiE WHERE IdAspNetUsers=ASP.Id AND PbiE.EstadoExamen=3 and IdSimuladorPbiModo=3 ORDER BY FechaCreacion DESC) AS FechaUltimaSimulacion,
	'Intermedio' AS Nivel,
	ISNULL(CAS.IdEstadoCertificacionSimulador,1) AS IdCertificacion
	FROM [40.76.216.5].[integraDB_PortalWeb].dbo.AspNetUsers AS ASP
	INNER JOIN fin.T_MatriculaCabecera AS MC ON MC.IdAlumno=ASP.IdAlumno
	INNER JOIN pla.T_Pespecifico AS PE ON MC.IdPespecifico= PE.Id
	INNER JOIN pla.T_CentroCosto AS CC ON CC.Id=PE.IdCentroCosto
	INNER JOIN pla.T_Pgeneral AS PG on PG.Id = PE.IdProgramaGeneral
	INNER JOIN mkt.T_Alumno AS AL ON AL.Id=MC.IdAlumno
	CROSS APPLY (SELECT TOP 1 * from ope.T_AccesosSimuladoreWebMatricula AS ASWM where ASWM.IdMatriculaCabecera=MC.Id AND ASWM.Estado=1 AND IdTipoSimuladorWeb=1) AS ASWM2
	LEFT JOIN pw.T_PW_CertificacionAlumnoSimulador AS CAS ON CAS.IdMatriculaCabecera=MC.Id AND CAS.Estado=1
	WHERE ASP.Id!='dffb3b89-2348-4054-bb28-8a306d47ead5'

	GO